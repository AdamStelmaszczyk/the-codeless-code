Number: 103
Title: The Black Enamel Box
Geekiness: 2
Names: Bawan
Topics: production support, logging, code rot
Date: 2013-07-21
Skip: 0


Master [[Bawan]] posed this dilemma to the developers
in his charge:

"When investigating strange behavior in the production
environment, our most powerful weapon has always been debug
messages: the more numerous and detailed, the better.  Yet
when used copiously, the formatting of such messages becomes
expensive -- /needlessly/ expensive, for we exclude debug
messages from our logs when we are not 
investigating problems.  So which path is best?  Safe but
slow, or heedless but fast?"

<i>"WÃº,"</i> said one of the nuns.  "Everything may be
logged, with minimal expense.  Wrap every /debug/ call
within an /if/ statement which verifies that debugging is on
before bothering to format the message.  We will only be
slow when we need to be safe."

Bawan considered this, and seemed pleased.
He bade the nun implement her approach in an application
that was presently being designed.  As further reward for
her cleverness he presented her with two enamel boxes.

"Open the red box immediately," said Bawan, "but leave the
black box shut tight.  In time it will serve you."

Inside the red box the nun discovered a small bowl full of
succulent kiwi fruit, lychee, and white pears, resting on a
bed of goji berries.  These she enjoyed greatly that
very evening.  Afterwards she placed both boxes on a high
shelf, and eventually forgot about them.

- - -

Two years later, after the system had undergone several
enhancements, a minor production problem appeared --
the first in many releases.  The nun requested that the
system be restarted in debug mode.

Suddenly, stack traces from NullPointerExceptions appeared
on the screens of every user.  The system had become completely
unusable.  As the nun stood aghast amid the chaos,
master Bawan sidled up to her and whispered, "Now fetch the
black box."

When the lid was lifted a foul odor issued forth.  Inside
lay a small bowl filled with the mouldy, dessicated remains
of what appeared to have once been kiwi fruit, lychee, pears and
goji berries.

The nun requested that debug mode be turned off
and then closed the box, enlightened.



###END

A certain nun had been assigned a new application to
develop, and was considering how to best prepare for the
bugs that would inevitably surface when the system went
operational.  She knew that frequent, detailed debug
messages would be her most powerful weapon, yet she was
concerned about impacting the system's performance
during normal operation, when debugging would be turned off
and all her elegantly-formatted messages would be discarded.

After much consideration, the nun decided to wrap every
/debug/ call inside an /if/ statement which would first
verify whether debugging was turned on.  If it was off, then
no attempt would be made to format and log the message.

The nun employed this coding pattern quite diligently, and
enjoyed much success in the early weeks after deployment:
when the odd problem appeared, the nun would have debugging
turned on and the logs would fill with her messages.  At
such times the system ran slowly, but problems were resolved
quickly.

Upon learning of the nun's technique, master [[Bawan]] sent her
two congratulatory presents sealed in two enamel boxes.
He bade her open the red box immediately, but to leave the
black one closed until he sent word.  Inside the red box
was a succulent plum.  The contents of the black box remained
a mystery; eventually, she placed it on a high shelf and
forgot about it.

Two years later, after the system had undergone several
major enhancements, a small production problem appeared --
the first in many releases.  The nun requested that the
system be restarted in debug mode.

Suddenly, stack traces from NullPointerExceptions appeared
on the screens of every user; that system had become completely
unusable.  Frantically the nun had the system restarted with
debugging turned off, and all went back to normal.
Upon investigation, she discovered that the exceptions had
come from certain old /debug/ calls whose assumptions about
the objects they logged had been invalidated by recent code
changes.





